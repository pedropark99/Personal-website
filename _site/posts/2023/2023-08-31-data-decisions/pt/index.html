<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro Duarte Faria">
<meta name="dcterms.date" content="2023-10-28">
<meta name="description" content="Este artigo descreve um exemplo real em que eu e meu time usamos dados para convencer o nosso cliente na época a tomar uma melhor decisão.">

<title>Um pequeno exemplo sobre como utilizar dados para tomar melhores decisões – home |&gt; dplyr::glimpse()</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7E6XG4WKHE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7E6XG4WKHE', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">home |&gt; dplyr::glimpse()</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-posts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Posts</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-posts">    
        <li>
    <a class="dropdown-item" href="../../../../posts/index.html">
 <span class="dropdown-text">All posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/en.html">
 <span class="dropdown-text">Posts in english</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/pt.html">
 <span class="dropdown-text">Posts em português</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-publications" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Publications</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-publications">    
        <li>
    <a class="dropdown-item" href="../../../../publications/index.html">
 <span class="dropdown-text">All publications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/en.html">
 <span class="dropdown-text">Publications in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/pt.html">
 <span class="dropdown-text">Publicações em Português</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../open_source_contrib.html"> 
<span class="menu-text">Open source contributions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../donate.html"> 
<span class="menu-text">Donate or Sponsor Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-english.pdf">
 <span class="dropdown-text">CV in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-portuguese.pdf">
 <span class="dropdown-text">CV em Português</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:pedropark99@gmail.com"> <i class="bi bi-envelope-fill" role="img" aria-label="Email for contact">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedropark99"> <i class="bi bi-github" role="img" aria-label="Github profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/web/@pedropark99"> <i class="bi bi-mastodon" role="img" aria-label="Mastodon profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/PedroPark9"> <i class="bi bi-twitter-x" role="img" aria-label="Twitter profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/pedro-faria-a68140209/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://pedro-faria.netlify.app/index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS feed for Pedro's blog">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Um pequeno exemplo sobre como utilizar dados para tomar melhores decisões</h1>
                  <div>
        <div class="description">
          Este artigo descreve um exemplo real em que eu e meu time usamos dados para convencer o nosso cliente na época a tomar uma melhor decisão.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Data Storytelling</div>
                <div class="quarto-category">Data Science</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Pedro Duarte Faria </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Blip
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 28, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">1</span> Introdução</a></li>
  <li><a href="#um-analista-de-dados-deveria-focar-em-entender-o-negócio" id="toc-um-analista-de-dados-deveria-focar-em-entender-o-negócio" class="nav-link" data-scroll-target="#um-analista-de-dados-deveria-focar-em-entender-o-negócio"><span class="header-section-number">2</span> Um analista de dados deveria focar em entender o negócio</a></li>
  <li><a href="#contexto" id="toc-contexto" class="nav-link" data-scroll-target="#contexto"><span class="header-section-number">3</span> Contexto</a>
  <ul class="collapse">
  <li><a href="#o-produto-de-empréstimo-com-garantia" id="toc-o-produto-de-empréstimo-com-garantia" class="nav-link" data-scroll-target="#o-produto-de-empréstimo-com-garantia"><span class="header-section-number">3.1</span> O produto de empréstimo com garantia</a></li>
  <li><a href="#um-critério-estranho" id="toc-um-critério-estranho" class="nav-link" data-scroll-target="#um-critério-estranho"><span class="header-section-number">3.2</span> Um critério estranho</a></li>
  <li><a href="#por-que-esse-critério-era-estranho" id="toc-por-que-esse-critério-era-estranho" class="nav-link" data-scroll-target="#por-que-esse-critério-era-estranho"><span class="header-section-number">3.3</span> Por que esse critério era estranho?</a></li>
  <li><a href="#por-que-esse-critério-existia" id="toc-por-que-esse-critério-existia" class="nav-link" data-scroll-target="#por-que-esse-critério-existia"><span class="header-section-number">3.4</span> Por que esse critério existia?</a></li>
  </ul></li>
  <li><a href="#o-que-nós-descobrimos" id="toc-o-que-nós-descobrimos" class="nav-link" data-scroll-target="#o-que-nós-descobrimos"><span class="header-section-number">4</span> O que nós descobrimos</a></li>
  <li><a href="#usando-dados-para-atingir-um-resultado-melhor" id="toc-usando-dados-para-atingir-um-resultado-melhor" class="nav-link" data-scroll-target="#usando-dados-para-atingir-um-resultado-melhor"><span class="header-section-number">5</span> Usando dados para atingir um resultado melhor</a></li>
  <li><a href="#a-nova-estratégia-de-vendas" id="toc-a-nova-estratégia-de-vendas" class="nav-link" data-scroll-target="#a-nova-estratégia-de-vendas"><span class="header-section-number">6</span> A nova estratégia de vendas</a></li>
  <li><a href="#o-resultado-final" id="toc-o-resultado-final" class="nav-link" data-scroll-target="#o-resultado-final"><span class="header-section-number">7</span> O resultado final</a></li>
  <li><a href="#conclusão" id="toc-conclusão" class="nav-link" data-scroll-target="#conclusão"><span class="header-section-number">8</span> Conclusão</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introdução" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introdução</h1>
<p>Este artigo descreve um exemplo real em que eu e meu time usamos dados para convencer o nosso cliente na época (que é um dos maiores bancos do mercado brasileiro) a tomar uma melhor decisão. Agradecimentos especiais ao <a href="https://www.linkedin.com/in/guilhermeggarcia/">Guilherme Goes</a> e ao <a href="https://www.linkedin.com/in/paulo-gon-oli/">Paulo Gonçalves</a>. Ambos me ajudaram a montar e apresentar essas ideias e <em>insigths</em> para o nosso cliente.</p>
<p>Em resumo, <strong>tomar decisões é difícil</strong>. Mas você sempre toma uma decisão melhor quando você tem dados para guiá-lo em direção a um resultado melhor e mais seguro. Quando você não tem dados para te defender, você está basicamente no escuro. Ou seja, você toma a decisão, mas não sabe antecipadamente quais são os possíveis resultados dessa decisão. Você apenas espera o melhor, e esta é sempre uma posição difícil de se estar.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Todos os dados, gráficos e imagens mostrados neste artigo são meramente ilustrativos. Portanto, eles não representam os dados reais de Blip ou do banco envolvido de nenhuma forma ou dimensão!</p>
</div>
</div>
</section>
<section id="um-analista-de-dados-deveria-focar-em-entender-o-negócio" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Um analista de dados deveria focar em entender o negócio</h1>
<p>Você provavelmente vai notar que grande parte deste artigo é dedicado a contextualizar e explicar o negócio por trás deste exemplo.</p>
<p>Isso é intencional! Porque, um dos reais valores deste artigo é mostrar que chegamos a uma boa proposta para o nosso cliente, porque nós entendemos o negócio desse cliente, e levantamos algumas hipóteses boas sobre esse negócio, e ao analisarmos essas hipóteses nós conseguimos chegar a uma boa nova estratégia.</p>
<p>Se você não entende o negócio que está analisando, é menos provável que você encontre uma boa estratégia ou uma boa análise de dados. Em outras palavras, ao ter um bom entendimento do negócio, você provavelmente terá ideias muito melhores sobre “como” analisar os dados que possui.</p>
</section>
<section id="contexto" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Contexto</h1>
<p>Em resumo, o nosso cliente era um grande banco brasileiro, um dos maiores do mercado. O banco estava utilizando nossa plataforma digital para vender diversos produtos e serviços pelo <a href="https://www.whatsapp.com/">WhatsApp</a>. Nosso trabalho foi analisar os dados gerados pela plataforma para entender como o banco poderia aumentar suas vendas dentro deste canal.</p>
<section id="o-produto-de-empréstimo-com-garantia" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="o-produto-de-empréstimo-com-garantia"><span class="header-section-number">3.1</span> O produto de empréstimo com garantia</h2>
<p>O empréstimo com garantia era um dos diversos produtos oferecidos pelo banco no WhatsApp. Para adquirir este produto, o usuário precisava responder diversas perguntas, e também, se enquadrar em alguns critérios.</p>
<p>Dependendo do tipo de setor em que você atua, você pode chamar isso de “fluxo de vendas”, ou “caminho de vendas”, que nada mais é do que o caminho (ou as etapas) que o usuário precisa seguir para adquirir o produto que você está vendendo.</p>
<p>A maioria das empresas deseja tornar esse caminho o mais curto possível para que o usuário chegue ao produto com mais rapidez. Porém, estamos falando de um empréstimo, então o banco certamente precisa de muitas informações pessoais e financeiras do usuário antes de conceder o empréstimo.</p>
<p>Ou seja, neste exemplo, o usuário precisava responder uma quantidade considerável de perguntas pelo WhatsApp para chegar à etapa final do caminho de vendas para adquirir o empréstimo.</p>
<p>A maioria dessas perguntas solicitava algumas informações pessoais, para verificar se esse usuário específico se enquadrava ou não em alguns critérios importantes. A maioria desses critérios eram bastante comuns (ou o <em>standard</em>) para qualquer tipo de empréstimo. Por exemplo, a pessoa não deveria ter nenhuma dívida legal com o governo. Alguns outros critérios eram puramente financeiros e patrimoniais, e também eram uma prática muito comum entre os bancos, como… a pessoa precisa estar totalmente empregada, precisa ter um carro totalmente pago, e, esse carro precisa ser uma propriedade pessoal da pessoa, ou seja, não poderia ser um carro emprestado de outra pessoa.</p>
</section>
<section id="um-critério-estranho" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="um-critério-estranho"><span class="header-section-number">3.2</span> Um critério estranho</h2>
<p>Porém um dos vários critérios era um pouco estranho para nós. Identificar exatamente qual critério era esse não é importante para o conteúdo deste artigo. Portanto, vamos dizer apenas que, para que um usuário consiga adquirir esse empréstimo, <strong>ele precisava necessariamente ser elegível para três modalidades diferentes</strong>.</p>
<p>Cada modalidade correspondia a um tipo diferente de empréstimo. Se o usuário não fosse elegível a todas essas três modalidades (ou tipos de empréstimo), nós automaticamente rejeitamos a solicitação de empréstimo desse usuário.</p>
<p>Em essência, tínhamos um fluxo que funcionava mais ou menos assim:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../flow-pt.png" class="img-fluid figure-img"></p>
<figcaption>Uma pequena representação do fluxo de vendas</figcaption>
</figure>
</div>
<p>Cada vez que um usuário entrava em nosso fluxo, nós coletamos o CPF desse usuário. Pois com esse CPF podemos usar a API para verificar múltiplas informações sobre essa pessoa de uma vez só. Uma das muitas coisas que nós verificávamos nessa chamada de API, era se esse usuário se encaixava no critério estranho que descrevemos. Isto é, nós conferíamos se esse usuário era elegível ou não às três modalidades de empréstimo.</p>
</section>
<section id="por-que-esse-critério-era-estranho" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="por-que-esse-critério-era-estranho"><span class="header-section-number">3.3</span> Por que esse critério era estranho?</h2>
<p>Na nossa cabeça, este era um critério muito estranho, porque… se uma usuária chamada “Ana” por exemplo for elegível para a modalidade A, então, por que não oferecer um empréstimo da modalidade A para a “Ana”? Como um outro exemplo, se um o usuário “Mike” é elegível para ambas as modalidades A e B, então por que não oferecer ambas as modalidades (A e B) para ele? Ou seja, por que não oferecer ao usuário qualquer tipo de empréstimo ao qual ele é elegível?</p>
<p>Por que apenas usuários que são elegíveis para todas as três modalidades (A, B e C) podem adquirir o empréstimo? Na nossa cabeça esse critério não fazia muito sentido, pois se um usuário for elegível a uma modalidade de empréstimo, ele deveria ser capaz de obter um empréstimo nesta modalidade ao qual ele tem direito.</p>
</section>
<section id="por-que-esse-critério-existia" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="por-que-esse-critério-existia"><span class="header-section-number">3.4</span> Por que esse critério existia?</h2>
<p>Mas vamos encara um fato. Apesar de este ser um critério estranho, certamente existe uma razão para ele existir. Nada existe sem uma razão. Nós imaginamos que esse critério estranho existia provavelmente por causa de:</p>
<ol type="1">
<li>uma estratégia MVP.</li>
<li>ou de uma estratégia de risco, em outras palavras, por causa de um <em>trade-off</em>.</li>
</ol>
<p>Uma estratégia MVP significa que o banco decidiu incluir esse critério estranho porque incluí-lo reduziria muito a complexidade do desenvolvimento do fluxo de vendas, e, portanto, ao simplificar o desenvolvimento, o banco poderia entregar um MVP (<em>minimal viable product</em>, ou, produto mínimo viável) o mais rápido possível e, como consequência, ele poderia começar a lucrar com esse produto mais rapidamente.</p>
<p>Por outro lado, uma estratégia de risco significa que o banco decidiu incluir este critério estranho, porque ele provavelmente estimou que o risco é consideravelmente maior para pessoas que não são elegíveis para as três modalidades. Se o risco estimado for muito alto, então o banco tem um bom motivo para não oferecer esse empréstimo a pessoas que são elegíveis a apenas uma ou duas modalidades diferentes.</p>
<p>Os bancos enfrentam constantemente uma escolha (ou uma balança) entre risco e lucro. Ou seja, um empréstimo de qualquer tipo é sempre uma boa oportunidade de lucro para o banco. No entanto, esta oportunidade de lucro tem sempre um custo atrelado a ela. Esse custo aparece principalmente na forma de risco para o banco.</p>
<p>É por isso que os bancos são normalmente muito bons em analisar e estimar riscos. Quando uma pessoa busca adquirir um empréstimo, o banco passa a analisar diversos fatores para estimar o quanto arriscado é conceder um empréstimo a essa pessoa.</p>
</section>
</section>
<section id="o-que-nós-descobrimos" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> O que nós descobrimos</h1>
<p>Independentemente de qual das opções acima tenha sido realmente a estratégia exata adotada pelo banco, nós tínhamos a hipótese de que esta regra de negócio (ou este “critério estranho”) estava afetando severamente o resultado das vendas.</p>
<p>Criamos essa hipótese, pois nós percebemos uma grande perda de usuários na etapa do fluxo de vendas onde fazemos todas as múltiplas validações através da API, verificando se o usuário se enquadrava ou não em todos os critérios e regras de negócio.</p>
<p><img src="./../funnel-chart-pt.png" class="img-fluid"></p>
<p>Nós não sabíamos qual dos muitos critérios específicos era a verdadeira fonte desta perda. Mas nós tínhamos a suspeita de que o critério “elegível para todas as 3 modalidades” era o critério problemático que gerava essa enorme perda.</p>
<p>Em outras palavras, nós suspeitamos que essa estratégia de rejeitar usuários que não possuíam as três modalidades não valia a pena, independente de quais decisões o banco tenha realmente tomado para incluir esse critério no fluxo de vendas. Mas precisávamos confirmar esta hipótese.</p>
<p>Nós tínhamos acesso aos dados retornados pela API (a que usamos para puxar várias informações do usuário), e com esses dados, nós poderíamos potencialmente identificar quais usuários possuíam as três modalidades e quais não possuíam. Então eu montei um script de R simples para coletar através da API os dados de cada usuário que visitou o nosso fluxo de vendas no último mês, e coloquei esse script para rodar durante a noite.</p>
<p>No dia seguinte, eu tinha todos os dados localmente na minha máquina, que tinham um formato parecido com esse:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"username"</span><span class="fu">:</span><span class="st">"Ana"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"cpf"</span><span class="fu">:</span><span class="st">"12212212212"</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"loan_analysis"</span><span class="fu">:{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="dt">"loan_modalities_elegible_to"</span><span class="fu">:</span><span class="ot">[</span><span class="st">"A"</span><span class="ot">,</span><span class="st">"B"</span><span class="ot">]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"username"</span><span class="fu">:</span><span class="st">"Mike"</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"cpf"</span><span class="fu">:</span><span class="st">"13313313313"</span><span class="fu">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"loan_analysis"</span><span class="fu">:{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>         <span class="dt">"loan_modalities_elegible_to"</span><span class="fu">:</span><span class="ot">[]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"username"</span><span class="fu">:</span><span class="st">"Arthur"</span><span class="fu">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"cpf"</span><span class="fu">:</span><span class="st">"14414414414"</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"loan_analysis"</span><span class="fu">:{</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="dt">"loan_modalities_elegible_to"</span><span class="fu">:</span><span class="ot">[</span><span class="st">"A"</span><span class="ot">,</span><span class="st">"B"</span><span class="ot">,</span><span class="st">"C"</span><span class="ot">]</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">}</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Começamos então a analisar esses dados, investigando os metadados de cada usuário e potencialmente medindo o tamanho do buraco que essa regra de negócio estava criando.</p>
<p>Como resultado, descobrimos que o banco estava constantemente <strong>perdendo uma grande oportunidade</strong> por causa desse critério estranho, ou, dessa regra de negócio específica. Fazendo algumas contas básicas, identificamos que <strong>67% dos usuários que visitaram nosso canal não eram elegíveis às três modalidades</strong>. Isso significa que 67% dos usuários que entravam em nosso canal eram automaticamente rejeitados. Estávamos constantemente perdendo uma grande quantidade de potenciais <em>leads</em> porque eles não se enquadravam nesse critério.</p>
<p>Tendo isso em mente, por exemplo, se 13.000 usuários entrassem em nosso canal, apenas (1 - 0,67) x 13.000 = 4.290 desses usuários poderiam potencialmente terminar o fluxo e adquirir o empréstimo. Os 8.710 usuários restantes eram automaticamente perdidos. Eles eram rejeitados porque não tinham essas três modalidades.</p>
<p>Essa descoberta gerou algumas possibilidades importantes para nós:</p>
<ul>
<li>Estamos alcançando o público certo?</li>
<li>Talvez devêssemos focar em atrair apenas pessoas que possuem as três modalidades para o nosso canal?</li>
<li>Este critério ou regra de negócio vale a pena?</li>
</ul>
</section>
<section id="usando-dados-para-atingir-um-resultado-melhor" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Usando dados para atingir um resultado melhor</h1>
<p>Nosso trabalho foi usar os dados que coletamos da API para mostrar ao banco que, os ganhos potenciais de vendermos diferentes tipos de empréstimos para esses usuários que não tinham as três modalidades eram muito maiores do que o risco que esses usuários ofereciam, ou muito maiores que o esforço necessário para desenvolver essa nova estratégia de vendas no fluxo.</p>
<p>Ou seja, usando dados, nós podiamos mostrar ao banco (em números) o tamanho da oportunidade que ele estava perdendo. E foi exatamente isso que fizemos. Nosso argumento foi basicamente dividido em duas partes distintas:</p>
<ol type="1">
<li>o tamanho do buraco, ou da perda que estávamos tendo;</li>
<li>o tamanho do ganho potencial que poderíamos ter.</li>
</ol>
<p>A primeira parte da nossa apresentação estava focada nos 67%. Nós mostramos ao banco que 67% dos usuários (que é um número enorme) eram constantemente rejeitados no fluxo. Mas este número por si só não tem muito significado. Desde que o banco esteja maximizando o seu lucro, ele não se importa se ele está recusando 60%, 70%, ou 80% dos usuários.</p>
<p>É por isso que na segunda parte da apresentação fizemos algumas contas básicas para estimar os ganhos potenciais que eles estavam perdendo por não venderem para esses 67% de usuários.</p>
</section>
<section id="a-nova-estratégia-de-vendas" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> A nova estratégia de vendas</h1>
<p>Uma rápida recapitulação. Cada usuário que entrava no nosso fluxo de vendas desejava obter um empréstimo. Porém, esse usuário precisava ser elegível a três tipos diferentes de empréstimo para realmente ser capaz de adquirir o empréstimo que desejava por meio do nosso canal.</p>
<p>Mas, e se mudarmos esse fluxo de vendas, para que:</p>
<ul>
<li>O usuário não precise ser elegível às três modalidades para adquirir um empréstimo;</li>
<li>Se um usuário for elegível a uma modalidade específica, então devemos oferecer um empréstimo dessa modalidade a que ele é elegível;</li>
<li>Caso um usuário seja elegível a mais de uma modalidade, então, devemos oferecer múltiplas opções de empréstimos para ele, uma para cada modalidade a que ele é elegível;</li>
</ul>
<p>Usando os mesmos dados da API que usamos para chegar aos 67%, nós também estimamos que, se alterássemos o fluxo de vendas para que ele se ajustasse às condições acima, aumentaríamos a cobertura de usuários para 96,8%! Isto significa que poderíamos vender um empréstimo a 96,8% dos usuários que entrassem no nosso fluxo de vendas, em vez de apenas 33%.</p>
<p>Caso você esteja pensando que 33% + 67% deveria ser igual a 100%, você está se esquecendo de que o usuário precisa se enquadrar em alguns outros critérios que não mencionei aqui. Ou seja, 96,8 - 100 = 3,2% dos usuários ainda seriam rejeitados por não se enquadrarem em outros critérios necessários.</p>
</section>
<section id="o-resultado-final" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> O resultado final</h1>
<p>O tempo e o esforço necessários para desenvolver esta nova estratégia no fluxo de vendas eram relativamente baixos e os ganhos potenciais dela eram bastante elevados! Ao aumentar a cobertura de usuários de 33% para 96,8%, estimamos que as vendas poderiam ter um aumento potencial de 193%. Spoiler! Essa estimativa foi muito baixa em comparação com o resultado final que obtivemos. Mas é assim que estimativas funcionam, não é mesmo? São apenas estimativas.</p>
<p>Então os gerentes do banco ficaram muito felizes com a proposta. Os gestores rapidamente aceitaram a ideia. Um baixo esforço para um ganho potencial alto.</p>
<p>Se você pensar sobre, essa nova estratégia que criamos era muito simples. Ela apenas incluía mais opções para os usuários que não se enquadravam no cenário ideal do banco. Mas apesar dessa estratégia ser simples, nós escrevemos uma proposta bem curta, clara e eficaz (eram basicamente apenas 4 slides). Nós mostramos o tamanho do buraco ao banco e também mostramos o tamanho da oportunidade que poderíamos obter se implementássemos essa nossa nova estratégia, e também mostrámos que esta nova estratégia era relativamente fácil e rápida de ser implementada no fluxo.</p>
<p>No entanto, o resultado final foi enorme. No primeiro mês após implementarmos esta nova estratégia no ambiente de produção, as vendas aumentaram aproximadamente 142%, já no segundo mês, o aumento chegou a 400%. As vendas deste empréstimo específico têm uma forte componente sazonal, por isso temos uma variação tão grande de 142% a 400%. Mas de qualquer modo, isto demonstra o impacto positivo que a nossa nova estratégia obteve. O resultado final de <strong>400% de aumento de vendas</strong> com a nossa proposta foi enorme.</p>
</section>
<section id="conclusão" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Conclusão</h1>
<p>Identificamos um critério estranho que nosso cliente incluiu no fluxo de vendas. Levantamos algumas hipóteses simples sobre esse critério estranho e usamos dados para confirmar ou testar essa hipótese.</p>
<p>Ao analisar esses dados, identificamos uma grande oportunidade para o nosso cliente. Construímos então uma apresentação simples com uma proposta ao nosso cliente, com os números que calculamos a partir da análise dos dados que fizemos.</p>
<p>No final, esta proposta foi um grande sucesso para a nossa equipe, e também para o nosso cliente que obteve um grande aumento de vendas após implementarmos as melhorias que propusemos.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pedro-faria\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>