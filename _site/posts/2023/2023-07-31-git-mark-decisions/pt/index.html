<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro Duarte Faria">
<meta name="dcterms.date" content="2023-07-31">
<meta name="description" content="Esse artigo usa um caso real que eu e meu time enfrentamos para mostrar como vocÃª pode melhorar a tomada de decisÃ£o de seu time, ao rastrear as suas decisÃµes com Git">

<title>Melhorando a tomada de decisÃ£o com Git e porquÃª vocÃª deveria se importar â€“ home |&gt; dplyr::glimpse()</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7E6XG4WKHE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7E6XG4WKHE', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">home |&gt; dplyr::glimpse()</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-posts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Posts</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-posts">    
        <li>
    <a class="dropdown-item" href="../../../../posts/index.html">
 <span class="dropdown-text">All posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/en.html">
 <span class="dropdown-text">Posts in english</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/pt.html">
 <span class="dropdown-text">Posts em portuguÃªs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-publications" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Publications</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-publications">    
        <li>
    <a class="dropdown-item" href="../../../../publications/index.html">
 <span class="dropdown-text">All publications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/en.html">
 <span class="dropdown-text">Publications in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/pt.html">
 <span class="dropdown-text">PublicaÃ§Ãµes em PortuguÃªs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../open_source_contrib.html"> 
<span class="menu-text">Open source contributions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../donate.html"> 
<span class="menu-text">Donate or Sponsor Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-english.pdf">
 <span class="dropdown-text">CV in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-portuguese.pdf">
 <span class="dropdown-text">CV em PortuguÃªs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:pedropark99@gmail.com"> <i class="bi bi-envelope-fill" role="img" aria-label="Email for contact">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedropark99"> <i class="bi bi-github" role="img" aria-label="Github profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/web/@pedropark99"> <i class="bi bi-mastodon" role="img" aria-label="Mastodon profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/PedroPark9"> <i class="bi bi-twitter-x" role="img" aria-label="Twitter profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/pedro-faria-a68140209/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://pedro-faria.netlify.app/index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS feed for Pedro's blog">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Melhorando a tomada de decisÃ£o com Git e porquÃª vocÃª deveria se importar</h1>
                  <div>
        <div class="description">
          Esse artigo usa um caso real que eu e meu time enfrentamos para mostrar como vocÃª pode melhorar a tomada de decisÃ£o de seu time, ao rastrear as suas decisÃµes com Git
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Git</div>
                <div class="quarto-category">Decisions</div>
                <div class="quarto-category">Documentation</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Pedro Duarte Faria </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Blip
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 31, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduÃ§Ã£o" id="toc-introduÃ§Ã£o" class="nav-link active" data-scroll-target="#introduÃ§Ã£o">IntroduÃ§Ã£o</a></li>
  <li><a href="#qual-Ã©-o-argumento-deste-artigo" id="toc-qual-Ã©-o-argumento-deste-artigo" class="nav-link" data-scroll-target="#qual-Ã©-o-argumento-deste-artigo">Qual Ã© o argumento deste artigo?</a></li>
  <li><a href="#o-pipeline-de-dados-onde-ocorreu-o-problema" id="toc-o-pipeline-de-dados-onde-ocorreu-o-problema" class="nav-link" data-scroll-target="#o-pipeline-de-dados-onde-ocorreu-o-problema">O pipeline de dados onde ocorreu o problema</a></li>
  <li><a href="#qual-foi-o-problema-que-ocorreu" id="toc-qual-foi-o-problema-que-ocorreu" class="nav-link" data-scroll-target="#qual-foi-o-problema-que-ocorreu">Qual foi o problema que ocorreu?</a></li>
  <li><a href="#investigando-os-commits" id="toc-investigando-os-commits" class="nav-link" data-scroll-target="#investigando-os-commits">Investigando os commits</a></li>
  <li><a href="#por-que-tomei-essa-decisÃ£o" id="toc-por-que-tomei-essa-decisÃ£o" class="nav-link" data-scroll-target="#por-que-tomei-essa-decisÃ£o">Por que tomei essa decisÃ£o?</a></li>
  <li><a href="#a-outra-parte-do-problema" id="toc-a-outra-parte-do-problema" class="nav-link" data-scroll-target="#a-outra-parte-do-problema">A outra parte do problema</a></li>
  <li><a href="#quais-erros-foram-cometidos" id="toc-quais-erros-foram-cometidos" class="nav-link" data-scroll-target="#quais-erros-foram-cometidos">Quais erros foram cometidos?</a></li>
  <li><a href="#como-o-git-nos-ajudou-a-resolver-o-problema" id="toc-como-o-git-nos-ajudou-a-resolver-o-problema" class="nav-link" data-scroll-target="#como-o-git-nos-ajudou-a-resolver-o-problema">Como o Git nos ajudou a resolver o problema</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduÃ§Ã£o" class="level1">
<h1>IntroduÃ§Ã£o</h1>
<p>Na semana passada, eu e minha equipe nos deparamos com uma situaÃ§Ã£o em que precisÃ¡vamos descobrir por que e como ocorreu um determinado problema. PrecisÃ¡vamos entender quais decisÃµes levaram a esse problema. Algo bem normal, nÃ£o Ã©?</p>
<p>Mas entender o que aconteceu sÃ³ foi possÃ­vel para nÃ³s porque rastreamos cada mudanÃ§a e cada decisÃ£o que tomamos com o Git, assinando commits e escrevendo Pull Requests (ou PRs para abreviar). Este artigo usa essa situaÃ§Ã£o do mundo real que enfrentamos para mostrar como o Git e os processos formais para registrar alteraÃ§Ãµes na base de cÃ³digo (como PRs) sÃ£o uma parte crÃ­tica para melhorar a tomada de decisÃµes e entender como suas decisÃµes passadas estÃ£o afetando vocÃª no presente.</p>
<p>ComeÃ§o o artigo descrevendo qual foi o problema que nÃ³s enfrentamos e, na sequÃªncia, explico quais erros foram cometidos e como o Git nos ajudou a identificar esses erros.</p>
</section>
<section id="qual-Ã©-o-argumento-deste-artigo" class="level1">
<h1>Qual Ã© o argumento deste artigo?</h1>
<p>Para melhorar o seu processo de tomada de decisÃ£o, vocÃª precisa primeiro se lembrar de quais foram as decisÃµes que vocÃª tomou. Ã€s vezes, essa lembranÃ§a se torna uma tarefa realmente difÃ­cil.</p>
<p>Diferentes pessoas adotam estratÃ©gias diferentes para acompanhar as decisÃµes que tomaram. Algumas pessoas mantÃªm vÃ¡rias anotaÃ§Ãµes sobre cada decisÃ£o, outros, gostam de documentar suas decisÃµes dentro dos cartÃµes (ou <em>cards</em>) criados dentro do quadro kanban de sua equipe. Mas independentemente de qual seja a estratÃ©gia que vocÃª escolher, ela sempre vai envolver algum tipo (ou nÃ­vel) de rastreamento e tambÃ©m de documentaÃ§Ã£o dessas decisÃµes que vocÃª faz ao longo do caminho.</p>
<p>Neste artigo, mostro um exemplo do mundo real em que o Git e o Pull Request formal desempenharam esse papel. Em outras palavras, este artigo busca mostrar como Git e Pull Requests podem te ajudar a acompanhar as decisÃµes que estÃ£o sendo feitas em sua equipe. Quem e por que eles tomaram essas decisÃµes? Quando essas decisÃµes aconteceram? etc.</p>
</section>
<section id="o-pipeline-de-dados-onde-ocorreu-o-problema" class="level1">
<h1>O pipeline de dados onde ocorreu o problema</h1>
<p>O problema ocorreu em um dos muitos pipelines de dados<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> que gerenciamos e oferecemos suporte. Esse pipeline de dados especÃ­fico era um pipeline do tipo â€œagregar os dados e enviar os resultados ao clienteâ€. Em detalhes mais tÃ©cnicos, esse pipeline era um arquivo JSON que continha todos os metadados que descreviam o que era esse pipeline, quais etapas deveriam ser executavas, quais eram as dependÃªncias e configuraÃ§Ãµes de cada tarefa, em que horÃ¡rio especÃ­fico do dia essas tarefas deveriam ser executadas, etc.</p>
<p>A principal etapa (ou tarefa) executada nesse pipeline era a execuÃ§Ã£o de um notebook de Python. Este notebook estava executando as seguintes etapas:</p>
<ul>
<li>agregar os dados brutos para obter o total de vendas feitas por canal.</li>
<li>salva o resultado em um arquivo CSV ou Excel.</li>
<li>enviar este arquivo CSV ou Excel por e-mail para o cliente.</li>
</ul>
<p>O diagrama a seguir mostra essas etapas de maneira visual:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../diagrams-pt.png" class="img-fluid figure-img"></p>
<figcaption>Um diagrama que resume o pipeline de dados onde o problema ocorreu</figcaption>
</figure>
</div>
</section>
<section id="qual-foi-o-problema-que-ocorreu" class="level1">
<h1>Qual foi o problema que ocorreu?</h1>
<p>Um dia, nosso cliente nos notificou dizendo que nÃ£o estava recebendo os arquivos CSV hÃ¡ cerca de uma semana. EntÃ£o comeÃ§amos a procurar por esse pipeline de dados, com o objetivo de verificar os seus logs de execuÃ§Ã£o. Contudo, nÃ³s simplesmente nÃ£o encontramos nada! Tanto o notebook Python quanto o arquivo JSON que descrevia o prÃ³prio pipeline de dados desapareceram! Ã‰ como se eles nunca tivessem existido.</p>
<p>NÃ£o ter o notebook Python era a mesma coisa que nÃ£o ter pipeline nenhum. Os arquivos Python e JSON simplesmente desapareceram de nosso repositÃ³rio. Mas nÃ³s sabÃ­amos que o cliente tinha recebido alguns arquivos a algumas semanas atrÃ¡s, portanto, tÃ­nhamos certeza de que esse pipeline existia em algum momento no passado. Mas para onde ele foi? Por que ele desapareceu?</p>
</section>
<section id="investigando-os-commits" class="level1">
<h1>Investigando os commits</h1>
<p>Usamos o Git para armazenar e rastrear quaisquer alteraÃ§Ãµes feitas em todos os nossos pipelines de dados. Em outras palavras, todas as alteraÃ§Ãµes que fazemos nos arquivos JSON que descrevem cada um de nossos pipelines de dados sÃ£o rastreadas pelo Git. Como vocÃª bem sabe, um arquivo simplesmente nÃ£o desaparece de um repositÃ³rio Git. Quando um arquivo Ã© removido de um repositÃ³rio Git, Ã© porque alguÃ©m excluiu intencionalmente o arquivo, e criou o commit da alteraÃ§Ã£o no repositÃ³rio.</p>
<p>Como sabÃ­amos que esse pipeline de dados existia em algum momento, eu comecei a investigar e seguir o histÃ³rico de commits. Demorou cerca de 30 minutos para encontrar o commit exato que excluiu o pipeline de dados e, oops! O commit foi criado por mim! Eu excluÃ­ o pipeline de dados do nosso repositÃ³rio. Okâ€¦ agora, por quÃª? Por que eu excluÃ­ esse pipeline de dados?</p>
<p>A essa altura, o Git jÃ¡ me ajudou a responder duas questÃµes muito importantes que eram: 1. Quem deletou o pipeline? 2. Quando foi excluÃ­do? Pois todo commit que vocÃª cria no Git tem um carimbo de data/hora associado a ele e o nome do autor desse commit, sabÃ­amos naquele momento que fui eu quem excluiu o pipeline, a algumas semanas atrÃ¡s.</p>
</section>
<section id="por-que-tomei-essa-decisÃ£o" class="level1">
<h1>Por que tomei essa decisÃ£o?</h1>
<p>Mas isso por si sÃ³ nÃ£o responde a outra parte do problema. Ainda precisamos saber o porquÃª tomei essa decisÃ£o. Por que excluÃ­ intencionalmente este pipeline? Este Ã© o ponto onde Pull Requests<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> podem nos ajudar.</p>
<p>Sempre que quisermos publicar alguma alteraÃ§Ã£o que fizemos em um pipeline de dados, precisamos documentar essa alteraÃ§Ã£o em um PR. Descrevemos quais mudanÃ§as foram feitas e por que as fizemos. Encontrei o PR associado que continha o commit que fiz e, na descriÃ§Ã£o desse PR, descobri o motivo pelo qual excluÃ­ o pipeline.</p>
<p>O pipeline estava constantemente falhando com um erro de â€œnotebook nÃ£o encontradoâ€. Em outras palavras, o pipeline estava tentando acionar a execuÃ§Ã£o do notebook Python que mencionei anteriormente. PorÃ©m o notebook em si nÃ£o foi encontrado, e por conta disso, estava dando esse erro. Isso significa que o pipeline era basicamente inÃºtil, ele estava criando custos de execuÃ§Ã£o sem entregar nenhum valor. Isso tambÃ©m significa que o notebook Python desapareceu antes que o pipeline fosse excluÃ­do.</p>
<p>EntÃ£o eu apaguei o pipeline. Dessa forma, nÃ³s deixamos de gastar nossos recursos tentando executar algo que sabemos que vai gerar um erro de execuÃ§Ã£o, e, consequentemente, nÃ£o vai gerar nenhum valor.</p>
</section>
<section id="a-outra-parte-do-problema" class="level1">
<h1>A outra parte do problema</h1>
<p>Ok, agora sabemos o porquÃª de eu ter excluÃ­do o pipeline. Mas isso por si sÃ³ levanta algumas novas questÃµes. Por que o notebook Python desapareceu? Todavia, a realidade Ã© queâ€¦ nÃ£o sabÃ­amos o porquÃª. Infelizmente, nossos notebooks Python nÃ£o estavan hospedados em um repositÃ³rio Git. Isso significa que nÃ£o nenhuma alteraÃ§Ã£o feita no notebook era rastreada.</p>
<p>PorÃ©m, para ser justo, nossos notebooks Python sÃ£o hospedados dentro de uma instÃ¢ncia do Databricks e, se vocÃª estiver familiarizado com o Databricks, saberÃ¡ que, na verdade, a plataforma Databricks rastreia sim (atÃ© certo ponto) alteraÃ§Ãµes feitas no notebook, atravÃ©s do <a href="https://docs.databricks.com/pt/notebooks/notebooks-code.html#version-control">painel de â€œRevisionsâ€</a>.</p>
<p>EntÃ£o, sim, temos algum nÃ­vel de monitoramento sobre as alteraÃ§Ãµes feitas nesses notebooks. Mas nÃ£o temos um nÃ­vel suficiente para realmente entendermos por que aquele caderno em particular estava faltando. Em outras palavras, esse painel de â€œRevisionsâ€ do Databricks nÃ£o Ã© capaz de rastrear aÃ§Ãµes de remoÃ§Ã£o em notebooks.</p>
<p>NÃ³s sÃ³ conseguimos descobrir o que estava acontecendo na semana seguinte, quando identificamos que outros notebooks de Python tambÃ©m haviam sumido misteriosamente da pasta do mesmo cliente. Era um conjunto de trÃªs notebooks, chamados <code>Job_ClientX_Opened_Sessions</code>, <code>Job_ClientX_Sales_per_Channel</code> e <code>Job_ClientX_Opened_Tickets</code>. Esses trÃªs notebooks estavam localizados na pasta <code>ClientX</code>. EntÃ£o, tÃ­nhamos uma estrutura de arquivo como esta:</p>
<pre><code>â”œâ”€â”€â”€ğŸ“ ClientX
â”‚    â”œâ”€â”€â”€Job_ClientX_Opened_Sessions.py
â”‚    â”œâ”€â”€â”€Job_ClientX_Sales_per_Channel.py
â”‚    â””â”€â”€â”€Job_ClientX_Opened_Tickets.py
â”‚ 
â”œâ”€â”€â”€ğŸ“ ClientY
â”œâ”€â”€â”€ğŸ“ ClientW
â””â”€â”€â”€ğŸ“ ClientZ
...</code></pre>
<p>Nesse dia especÃ­fico, descobrimos atravÃ©s dos logs de execuÃ§Ã£o que, por volta das 08:00 AM, esse conjunto de notebooks estava sim disponÃ­veis (ou seja, eles existiam de fato) em nosso ambiente Databricks por volta das 08:00. Mas nesse mesmo dia, quando nÃ³s procuramos novamente Ã s 11:00 por esses mesmos notebooks no ambiente Databricks, nÃ£o os encontramos mais.</p>
<p>SabÃ­amos naquele momento que esses notebooks haviam desaparecido nas Ãºltimas 3 horas. Era algo muito recente. Contudo, um detalhe chamou a nossa atenÃ§Ã£o. A pasta <code>ClientX</code>, que era onde deveriam estar esses notebooks, estava preenchida com outros notebooks que possuÃ­am nomes semelhantes aos que estÃ¡vamos procurando, como estes:</p>
<pre><code>â”œâ”€â”€â”€ğŸ“ ClientX
â”‚    â”œâ”€â”€â”€[ClientX] Opened sessions.py
â”‚    â”œâ”€â”€â”€[ClientX] Sales per Channel.py
â”‚    â””â”€â”€â”€[ClientX] Opened Tickets.py
â”‚ 
â”œâ”€â”€â”€ğŸ“ ClientY
â”œâ”€â”€â”€ğŸ“ ClientW
â””â”€â”€â”€ğŸ“ ClientZ
...</code></pre>
<p>A princÃ­pio, isso parecia muito estranho para nÃ³s, pois esses nomes iam contra as nossas convenÃ§Ãµes de nomenclatura. Ou seja, eu e minha equipe nÃ£o nomeamos arquivos dessa forma. EntÃ£o, novas desconfianÃ§a surgiram, e levantamos a seguinte hipÃ³tese: â€œespere! Acho que alguÃ©m estÃ¡ renomeando esses notebooksâ€. Mais tarde naquele dia, nossas suspeitas foram confirmadas. Um colega de fora de nossa equipe estava renomeando intencionalmente os notebooks de Python desse cliente que foram publicados no ambiente de produÃ§Ã£o. Por isso nÃ£o estÃ¡vamos encontrando mais os notebooks, pois os seus nomes foram modificados.</p>
<p>A consequÃªncia imediata dessa aÃ§Ã£o de nosso colega foi que a conexÃ£o entre os notebooks de Python e os pipelines de dados foi perdida. Ou seja, os pipelines de dados estavam tentando executar esses notebooks, mas esses pipelines nÃ£o estavam encontrando mais esses notebooks, pois os seus nomes originais foram perdidos.</p>
<p>Se usÃ¡ssemos o Git para rastrear todas as alteraÃ§Ãµes feitas nesses notebooks de Python, talvez nÃ³s terÃ­amos descoberto esse problema muito mais cedo, e, com isso, poderÃ­amos agir para corrigi-lo. PorÃ©m o estrago jÃ¡ havia sido feito. Como prÃ³ximos passos, o nosso time teve que:</p>
<ul>
<li>renomear os notebooks de volta para os seus nomes originais;</li>
<li>remover alguns dos privilÃ©gios de nosso colega no ambiente Databricks;</li>
<li>aconselhar este colega sobre o que aconteceu e como as suas aÃ§Ãµes causaram danos.</li>
</ul>
</section>
<section id="quais-erros-foram-cometidos" class="level1">
<h1>Quais erros foram cometidos?</h1>
<p>Abaixo temos a linha do tempo dos eventos importantes que descrevemos atÃ© aqui:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../timeline-pt.png" class="img-fluid figure-img"></p>
<figcaption>Uma timeline dos eventos</figcaption>
</figure>
</div>
<p>Na minha cabeÃ§a, existem pelo menos trÃªs erros que foram cometidos ao longo desta linha do tempo:</p>
<ul>
<li>Eu nÃ£o comuniquei a retirada do pipeline de forma adequada;</li>
<li>Nosso colega estava renomeando notebooks em um ambiente de produÃ§Ã£o;</li>
<li>NÃ£o usamos o Git para rastrear alteraÃ§Ãµes nos notebooks no ambiente de produÃ§Ã£o.</li>
</ul>
<p>Excluir o pipeline nÃ£o foi um erro. Na realdiade, o meu erro foi nÃ£o comunicar a minha aÃ§Ã£o da forma adequada. Quer dizer, eu comuniquei a remoÃ§Ã£o do pipeline aos meus colegas, mas eu nÃ£o comuniquei essa remoÃ§Ã£o ao meu colega de fora da minha equipe que tambÃ©m estava envolvido com esse cliente especÃ­fico, o mesmo colega que comeÃ§ou a renomear vÃ¡rios notebooks em produÃ§Ã£o.</p>
<p>Em outras palavras, se eu tivesse comunicado a ele que excluÃ­ o pipeline, provavelmente o seguinte diÃ¡logo teria acontecido:</p>
<ul>
<li><p>Colega: â€œespere! Nosso cliente ainda estÃ¡ usando esse pipeline de dados, por que vocÃª o removeu?â€</p></li>
<li><p>Eu: â€œporque o pipeline nÃ£o estava encontrando o notebookâ€</p></li>
<li><p>Colega: â€œmas porque ele nÃ£o estava achando o notebook?â€</p></li>
<li><p>Eu: â€œbom, o pipeline estÃ¡ procurando um notebook chamado â€˜Xâ€™, mas esse notebook sumiu. NÃ£o existe em nosso ambienteâ€.</p></li>
<li><p>Colega: â€œespere! Eu me lembro deste caderno! Acho que acabei de renomeÃ¡-lo hÃ¡ alguns diasâ€</p></li>
<li><p>Eu: â€œespere! VocÃª renomeou um notebook em produÃ§Ã£o?â€</p></li>
<li><p>Colega: â€œsim, acho que simâ€</p></li>
</ul>
<p>Com este diÃ¡logo, provavelmente poderÃ­amos ter resolvido o quebra-cabeÃ§a muito mais rapidamente e corrigido os erros antes que mais danos pudessem ser criados. Portanto, se eu tivesse comunicado a esse colega que excluÃ­ o pipeline, provavelmente atingirÃ­amos o cerne do problema mais rapidamente.</p>
<p>Tudo comeÃ§ou quando esse nosso colega decidiu renomear um notebook diretamente no ambiente de produÃ§Ã£o sem que soubÃ©ssemos. Isso com certeza foi um erro, mas quem nÃ£o erra as vezes nÃ©? AlÃ©m disso, como descrevemos no artigo, o sistema de â€œRevisionsâ€ do Databricks Ã© limitado e nÃ£o foi capaz de gravar essa mudanÃ§a tÃ£o importante no notebook e, por causa disso, nÃ³s inicialmente ficamos no escuro. NÃ³s nÃ£o tÃ­nhamos ideia do que havia acontecido com o notebook.</p>
<p>Levamos uma semana para realmente descobrir o que estava causando o â€œdesaparecimentoâ€ dos notebooks. Se usÃ¡ssemos o Git para rastrear todas as alteraÃ§Ãµes feitas nos notebooks publicados no ambiente de produÃ§Ã£o, nÃ³s terÃ­amos identificado a â€œaÃ§Ã£o de renomearâ€ muito, muito, muito mais rÃ¡pido. Portanto, nÃ£o usar o Git nesses notebooks tambÃ©m foi um erro.</p>
</section>
<section id="como-o-git-nos-ajudou-a-resolver-o-problema" class="level1">
<h1>Como o Git nos ajudou a resolver o problema</h1>
<p>O Git Ã© uma ferramenta extremamente poderosa. Ao termos um servidor centralizado que registra todas as mudanÃ§as que cada pessoa faz no projeto, conseguimos olhar para o passado, e entender quais mudanÃ§as foram feitas. VocÃª pode realmente ver a evoluÃ§Ã£o ou a linha do tempo do seu projeto e perceber quantos recursos ou melhorias vocÃª fez no projeto. VocÃª tambÃ©m pode identificar as decisÃµes que tomou no passado. Isso lhe dÃ¡ a capacidade de repensar o seu processo de tomada de decisÃ£o.</p>
<p>Um fato que sabÃ­amos desde o inÃ­cio: um pipeline de dados e um notebook de Python simplesmente desapareceram de nosso ambiente. Com o Git conseguimos rastrear e entender como, quando e por que o pipeline de dados desapareceu, e conseguimos localizar o pipeline de dados novamente, restaurÃ¡-lo ao seu estado anterior e reenviar os arquivos que o nosso cliente precisava. Se usÃ¡ssemos o Git nos notebooks, tambÃ©m poderÃ­amos rastrear as operaÃ§Ãµes de â€œrenomearâ€ que haviam sido feitas nesses notebooks.</p>
<p>NÃ³s nÃ£o apenas corrigimos o problema, mas tambÃ©m, ao entender o que aconteceu e quais decisÃµes foram tomadas que levaram ao desaparecimento do pipeline de dados, pudemos identificar as falhas em nosso processo de tomada de decisÃ£o. E ao identificar esses problemas, agora podemos resolvÃª-los, para nÃ£o cometermos esses erros novamente.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>O que Ã© um pipeline? Um pipeline Ã© apenas uma sequÃªncia de etapas (ou tarefas) a serem realizada em uma hora especÃ­fica do dia (ou em um dia especÃ­fico da semana ou do mÃªs, etc.). E um pipeline de dados Ã© um pipeline que contÃ©m tarefas que carregam, transformam, enviam ou ingerem dados de alguma forma.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>Em resumo, um Pull Request (ou PR) Ã© uma <strong>proposta</strong> para realizar uma operaÃ§Ã£o <code>git merge</code>. Em outras palavras, vocÃª cria um PR quando deseja mesclar as alteraÃ§Ãµes feitas em uma branch em outra branch (na maioria das vezes a main branch). O aspecto de â€œpropostaâ€ de uma PR significa que este PR precisa ser aprovado para ser efetivamente executado. Um PR nÃ£o Ã© um recurso do Git. Na verdade, Ã© um recurso padrÃ£o da maioria dos provedores de serviÃ§os Git. EntÃ£o vocÃª cria um PR dentro de uma plataforma de serviÃ§os Git como GitHub, GitLab e Azure DevOps, e nÃ£o dentro do prÃ³prio Git. Se vocÃª nÃ£o estÃ¡ familiarizado com PRs, a <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">documentaÃ§Ã£o do GitHub tem um excelente artigo sobre isso</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pedro-faria\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>