<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro Duarte Faria">
<meta name="dcterms.date" content="2023-07-31">
<meta name="description" content="Esse artigo usa um caso real que eu e meu time enfrentamos para mostrar como voc√™ pode melhorar a tomada de decis√£o de seu time, ao rastrear as suas decis√µes com Git">

<title>home |&gt; dplyr::glimpse() - Melhorando a tomada de decis√£o com Git e porqu√™ voc√™ deveria se importar</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7E6XG4WKHE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7E6XG4WKHE', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">home |&gt; dplyr::glimpse()</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-posts" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Posts</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-posts">    
        <li>
    <a class="dropdown-item" href="../../../../posts/index.html" rel="" target="">
 <span class="dropdown-text">All posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/en.html" rel="" target="">
 <span class="dropdown-text">Posts in english</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../posts/pt.html" rel="" target="">
 <span class="dropdown-text">Posts em portugu√™s</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-publications" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Publications</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-publications">    
        <li>
    <a class="dropdown-item" href="../../../../publications/index.html" rel="" target="">
 <span class="dropdown-text">All publications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/en.html" rel="" target="">
 <span class="dropdown-text">Publications in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../publications/pt.html" rel="" target="">
 <span class="dropdown-text">Publica√ß√µes em Portugu√™s</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../donate.html" rel="" target="">
 <span class="menu-text">Donate or Sponsor Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-english.pdf" rel="" target="">
 <span class="dropdown-text">CV in English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../files/cv/cv-portuguese.pdf" rel="" target="">
 <span class="dropdown-text">CV em Portugu√™s</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:pedropark99@gmail.com" rel="" target=""><i class="bi bi-envelope-fill" role="img" aria-label="Email for contact">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedropark99" rel="" target=""><i class="bi bi-github" role="img" aria-label="Github profile">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/web/@pedropark99" rel="" target=""><i class="bi bi-mastodon" role="img" aria-label="Mastodon profile">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://medium.com/@pedropark99" rel="" target=""><i class="bi bi-medium" role="img" aria-label="Medium profile">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/PedroPark9" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Twitter profile">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/pedro-faria-a68140209/" rel="" target=""><i class="bi bi-linkedin" role="img" aria-label="Linkedin profile">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://pedro-faria.netlify.app/index.xml" rel="" target=""><i class="bi bi-rss" role="img" aria-label="RSS feed for Pedro's blog">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Melhorando a tomada de decis√£o com Git e porqu√™ voc√™ deveria se importar</h1>
                  <div>
        <div class="description">
          Esse artigo usa um caso real que eu e meu time enfrentamos para mostrar como voc√™ pode melhorar a tomada de decis√£o de seu time, ao rastrear as suas decis√µes com Git
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Git</div>
                <div class="quarto-category">Decisions</div>
                <div class="quarto-category">Documentation</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Pedro Duarte Faria </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Take Blip
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 31, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introdu√ß√£o" class="level1">
<h1>Introdu√ß√£o</h1>
<p>Na semana passada, eu e minha equipe nos deparamos com uma situa√ß√£o em que precis√°vamos descobrir por que e como ocorreu um determinado problema. Precis√°vamos entender quais decis√µes levaram a esse problema. Algo bem normal, n√£o √©?</p>
<p>Mas entender o que aconteceu s√≥ foi poss√≠vel para n√≥s porque rastreamos cada mudan√ßa e cada decis√£o que tomamos com o Git, assinando commits e escrevendo Pull Requests (ou PRs para abreviar). Este artigo usa essa situa√ß√£o do mundo real que enfrentamos para mostrar como o Git e os processos formais para registrar altera√ß√µes na base de c√≥digo (como PRs) s√£o uma parte cr√≠tica para melhorar a tomada de decis√µes e entender como suas decis√µes passadas est√£o afetando voc√™ no presente.</p>
<p>Come√ßo o artigo descrevendo qual foi o problema que n√≥s enfrentamos e, na sequ√™ncia, explico quais erros foram cometidos e como o Git nos ajudou a identificar esses erros.</p>
</section>
<section id="qual-√©-o-argumento-deste-artigo" class="level1">
<h1>Qual √© o argumento deste artigo?</h1>
<p>Para melhorar o seu processo de tomada de decis√£o, voc√™ precisa primeiro se lembrar de quais foram as decis√µes que voc√™ tomou. √Äs vezes, essa lembran√ßa se torna uma tarefa realmente dif√≠cil.</p>
<p>Diferentes pessoas adotam estrat√©gias diferentes para acompanhar as decis√µes que tomaram. Algumas pessoas mant√™m v√°rias anota√ß√µes sobre cada decis√£o, outros, gostam de documentar suas decis√µes dentro dos cart√µes (ou <em>cards</em>) criados dentro do quadro kanban de sua equipe. Mas independentemente de qual seja a estrat√©gia que voc√™ escolher, ela sempre vai envolver algum tipo (ou n√≠vel) de rastreamento e tamb√©m de documenta√ß√£o dessas decis√µes que voc√™ faz ao longo do caminho.</p>
<p>Neste artigo, mostro um exemplo do mundo real em que o Git e o Pull Request formal desempenharam esse papel. Em outras palavras, este artigo busca mostrar como Git e Pull Requests podem te ajudar a acompanhar as decis√µes que est√£o sendo feitas em sua equipe. Quem e por que eles tomaram essas decis√µes? Quando essas decis√µes aconteceram? etc.</p>
</section>
<section id="o-pipeline-de-dados-onde-ocorreu-o-problema" class="level1">
<h1>O pipeline de dados onde ocorreu o problema</h1>
<p>O problema ocorreu em um dos muitos pipelines de dados<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> que gerenciamos e oferecemos suporte. Esse pipeline de dados espec√≠fico era um pipeline do tipo ‚Äúagregar os dados e enviar os resultados ao cliente‚Äù. Em detalhes mais t√©cnicos, esse pipeline era um arquivo JSON que continha todos os metadados que descreviam o que era esse pipeline, quais etapas deveriam ser executavas, quais eram as depend√™ncias e configura√ß√µes de cada tarefa, em que hor√°rio espec√≠fico do dia essas tarefas deveriam ser executadas, etc.</p>
<p>A principal etapa (ou tarefa) executada nesse pipeline era a execu√ß√£o de um notebook de Python. Este notebook estava executando as seguintes etapas:</p>
<ul>
<li>agregar os dados brutos para obter o total de vendas feitas por canal.</li>
<li>salva o resultado em um arquivo CSV ou Excel.</li>
<li>enviar este arquivo CSV ou Excel por e-mail para o cliente.</li>
</ul>
<p>O diagrama a seguir mostra essas etapas de maneira visual:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../diagrams-pt.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Um diagrama que resume o pipeline de dados onde o problema ocorreu</figcaption>
</figure>
</div>
</section>
<section id="qual-foi-o-problema-que-ocorreu" class="level1">
<h1>Qual foi o problema que ocorreu?</h1>
<p>Um dia, nosso cliente nos notificou dizendo que n√£o estava recebendo os arquivos CSV h√° cerca de uma semana. Ent√£o come√ßamos a procurar por esse pipeline de dados, com o objetivo de verificar os seus logs de execu√ß√£o. Contudo, n√≥s simplesmente n√£o encontramos nada! Tanto o notebook Python quanto o arquivo JSON que descrevia o pr√≥prio pipeline de dados desapareceram! √â como se eles nunca tivessem existido.</p>
<p>N√£o ter o notebook Python era a mesma coisa que n√£o ter pipeline nenhum. Os arquivos Python e JSON simplesmente desapareceram de nosso reposit√≥rio. Mas n√≥s sab√≠amos que o cliente tinha recebido alguns arquivos a algumas semanas atr√°s, portanto, t√≠nhamos certeza de que esse pipeline existia em algum momento no passado. Mas para onde ele foi? Por que ele desapareceu?</p>
</section>
<section id="investigando-os-commits" class="level1">
<h1>Investigando os commits</h1>
<p>Usamos o Git para armazenar e rastrear quaisquer altera√ß√µes feitas em todos os nossos pipelines de dados. Em outras palavras, todas as altera√ß√µes que fazemos nos arquivos JSON que descrevem cada um de nossos pipelines de dados s√£o rastreadas pelo Git. Como voc√™ bem sabe, um arquivo simplesmente n√£o desaparece de um reposit√≥rio Git. Quando um arquivo √© removido de um reposit√≥rio Git, √© porque algu√©m excluiu intencionalmente o arquivo, e criou o commit da altera√ß√£o no reposit√≥rio.</p>
<p>Como sab√≠amos que esse pipeline de dados existia em algum momento, eu comecei a investigar e seguir o hist√≥rico de commits. Demorou cerca de 30 minutos para encontrar o commit exato que excluiu o pipeline de dados e, oops! O commit foi criado por mim! Eu exclu√≠ o pipeline de dados do nosso reposit√≥rio. Ok‚Ä¶ agora, por qu√™? Por que eu exclu√≠ esse pipeline de dados?</p>
<p>A essa altura, o Git j√° me ajudou a responder duas quest√µes muito importantes que eram: 1. Quem deletou o pipeline? 2. Quando foi exclu√≠do? Pois todo commit que voc√™ cria no Git tem um carimbo de data/hora associado a ele e o nome do autor desse commit, sab√≠amos naquele momento que fui eu quem excluiu o pipeline, a algumas semanas atr√°s.</p>
</section>
<section id="por-que-tomei-essa-decis√£o" class="level1">
<h1>Por que tomei essa decis√£o?</h1>
<p>Mas isso por si s√≥ n√£o responde a outra parte do problema. Ainda precisamos saber o porqu√™ tomei essa decis√£o. Por que exclu√≠ intencionalmente este pipeline? Este √© o ponto onde Pull Requests<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> podem nos ajudar.</p>
<p>Sempre que quisermos publicar alguma altera√ß√£o que fizemos em um pipeline de dados, precisamos documentar essa altera√ß√£o em um PR. Descrevemos quais mudan√ßas foram feitas e por que as fizemos. Encontrei o PR associado que continha o commit que fiz e, na descri√ß√£o desse PR, descobri o motivo pelo qual exclu√≠ o pipeline.</p>
<p>O pipeline estava constantemente falhando com um erro de ‚Äúnotebook n√£o encontrado‚Äù. Em outras palavras, o pipeline estava tentando acionar a execu√ß√£o do notebook Python que mencionei anteriormente. Por√©m o notebook em si n√£o foi encontrado, e por conta disso, estava dando esse erro. Isso significa que o pipeline era basicamente in√∫til, ele estava criando custos de execu√ß√£o sem entregar nenhum valor. Isso tamb√©m significa que o notebook Python desapareceu antes que o pipeline fosse exclu√≠do.</p>
<p>Ent√£o eu apaguei o pipeline. Dessa forma, n√≥s deixamos de gastar nossos recursos tentando executar algo que sabemos que vai gerar um erro de execu√ß√£o, e, consequentemente, n√£o vai gerar nenhum valor.</p>
</section>
<section id="a-outra-parte-do-problema" class="level1">
<h1>A outra parte do problema</h1>
<p>Ok, agora sabemos o porqu√™ de eu ter exclu√≠do o pipeline. Mas isso por si s√≥ levanta algumas novas quest√µes. Por que o notebook Python desapareceu? Todavia, a realidade √© que‚Ä¶ n√£o sab√≠amos o porqu√™. Infelizmente, nossos notebooks Python n√£o estavan hospedados em um reposit√≥rio Git. Isso significa que n√£o nenhuma altera√ß√£o feita no notebook era rastreada.</p>
<p>Por√©m, para ser justo, nossos notebooks Python s√£o hospedados dentro de uma inst√¢ncia do Databricks e, se voc√™ estiver familiarizado com o Databricks, saber√° que, na verdade, a plataforma Databricks rastreia sim (at√© certo ponto) altera√ß√µes feitas no notebook, atrav√©s do <a href="https://docs.databricks.com/pt/notebooks/notebooks-code.html#version-control">painel de ‚ÄúRevisions‚Äù</a>.</p>
<p>Ent√£o, sim, temos algum n√≠vel de monitoramento sobre as altera√ß√µes feitas nesses notebooks. Mas n√£o temos um n√≠vel suficiente para realmente entendermos por que aquele caderno em particular estava faltando. Em outras palavras, esse painel de ‚ÄúRevisions‚Äù do Databricks n√£o √© capaz de rastrear a√ß√µes de remo√ß√£o em notebooks.</p>
<p>N√≥s s√≥ conseguimos descobrir o que estava acontecendo na semana seguinte, quando identificamos que outros notebooks de Python tamb√©m haviam sumido misteriosamente da pasta do mesmo cliente. Era um conjunto de tr√™s notebooks, chamados <code>Job_ClientX_Opened_Sessions</code>, <code>Job_ClientX_Sales_per_Channel</code> e <code>Job_ClientX_Opened_Tickets</code>. Esses tr√™s notebooks estavam localizados na pasta <code>ClientX</code>. Ent√£o, t√≠nhamos uma estrutura de arquivo como esta:</p>
<pre><code>‚îú‚îÄ‚îÄ‚îÄüìÅ ClientX
‚îÇ    ‚îú‚îÄ‚îÄ‚îÄJob_ClientX_Opened_Sessions.py
‚îÇ    ‚îú‚îÄ‚îÄ‚îÄJob_ClientX_Sales_per_Channel.py
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄJob_ClientX_Opened_Tickets.py
‚îÇ 
‚îú‚îÄ‚îÄ‚îÄüìÅ ClientY
‚îú‚îÄ‚îÄ‚îÄüìÅ ClientW
‚îî‚îÄ‚îÄ‚îÄüìÅ ClientZ
...</code></pre>
<p>Nesse dia espec√≠fico, descobrimos atrav√©s dos logs de execu√ß√£o que, por volta das 08:00 AM, esse conjunto de notebooks estava sim dispon√≠veis (ou seja, eles existiam de fato) em nosso ambiente Databricks por volta das 08:00. Mas nesse mesmo dia, quando n√≥s procuramos novamente √†s 11:00 por esses mesmos notebooks no ambiente Databricks, n√£o os encontramos mais.</p>
<p>Sab√≠amos naquele momento que esses notebooks haviam desaparecido nas √∫ltimas 3 horas. Era algo muito recente. Contudo, um detalhe chamou a nossa aten√ß√£o. A pasta <code>ClientX</code>, que era onde deveriam estar esses notebooks, estava preenchida com outros notebooks que possu√≠am nomes semelhantes aos que est√°vamos procurando, como estes:</p>
<pre><code>‚îú‚îÄ‚îÄ‚îÄüìÅ ClientX
‚îÇ    ‚îú‚îÄ‚îÄ‚îÄ[ClientX] Opened sessions.py
‚îÇ    ‚îú‚îÄ‚îÄ‚îÄ[ClientX] Sales per Channel.py
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ[ClientX] Opened Tickets.py
‚îÇ 
‚îú‚îÄ‚îÄ‚îÄüìÅ ClientY
‚îú‚îÄ‚îÄ‚îÄüìÅ ClientW
‚îî‚îÄ‚îÄ‚îÄüìÅ ClientZ
...</code></pre>
<p>A princ√≠pio, isso parecia muito estranho para n√≥s, pois esses nomes iam contra as nossas conven√ß√µes de nomenclatura. Ou seja, eu e minha equipe n√£o nomeamos arquivos dessa forma. Ent√£o, novas desconfian√ßa surgiram, e levantamos a seguinte hip√≥tese: ‚Äúespere! Acho que algu√©m est√° renomeando esses notebooks‚Äù. Mais tarde naquele dia, nossas suspeitas foram confirmadas. Um colega de fora de nossa equipe estava renomeando intencionalmente os notebooks de Python desse cliente que foram publicados no ambiente de produ√ß√£o. Por isso n√£o est√°vamos encontrando mais os notebooks, pois os seus nomes foram modificados.</p>
<p>A consequ√™ncia imediata dessa a√ß√£o de nosso colega foi que a conex√£o entre os notebooks de Python e os pipelines de dados foi perdida. Ou seja, os pipelines de dados estavam tentando executar esses notebooks, mas esses pipelines n√£o estavam encontrando mais esses notebooks, pois os seus nomes originais foram perdidos.</p>
<p>Se us√°ssemos o Git para rastrear todas as altera√ß√µes feitas nesses notebooks de Python, talvez n√≥s ter√≠amos descoberto esse problema muito mais cedo, e, com isso, poder√≠amos agir para corrigi-lo. Por√©m o estrago j√° havia sido feito. Como pr√≥ximos passos, o nosso time teve que:</p>
<ul>
<li>renomear os notebooks de volta para os seus nomes originais;</li>
<li>remover alguns dos privil√©gios de nosso colega no ambiente Databricks;</li>
<li>aconselhar este colega sobre o que aconteceu e como as suas a√ß√µes causaram danos.</li>
</ul>
</section>
<section id="quais-erros-foram-cometidos" class="level1">
<h1>Quais erros foram cometidos?</h1>
<p>Abaixo temos a linha do tempo dos eventos importantes que descrevemos at√© aqui:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../timeline-pt.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Uma timeline dos eventos</figcaption>
</figure>
</div>
<p>Na minha cabe√ßa, existem pelo menos tr√™s erros que foram cometidos ao longo desta linha do tempo:</p>
<ul>
<li>Eu n√£o comuniquei a retirada do pipeline de forma adequada;</li>
<li>Nosso colega estava renomeando notebooks em um ambiente de produ√ß√£o;</li>
<li>N√£o usamos o Git para rastrear altera√ß√µes nos notebooks no ambiente de produ√ß√£o.</li>
</ul>
<p>Excluir o pipeline n√£o foi um erro. Na realdiade, o meu erro foi n√£o comunicar a minha a√ß√£o da forma adequada. Quer dizer, eu comuniquei a remo√ß√£o do pipeline aos meus colegas, mas eu n√£o comuniquei essa remo√ß√£o ao meu colega de fora da minha equipe que tamb√©m estava envolvido com esse cliente espec√≠fico, o mesmo colega que come√ßou a renomear v√°rios notebooks em produ√ß√£o.</p>
<p>Em outras palavras, se eu tivesse comunicado a ele que exclu√≠ o pipeline, provavelmente o seguinte di√°logo teria acontecido:</p>
<ul>
<li><p>Colega: ‚Äúespere! Nosso cliente ainda est√° usando esse pipeline de dados, por que voc√™ o removeu?‚Äù</p></li>
<li><p>Eu: ‚Äúporque o pipeline n√£o estava encontrando o notebook‚Äù</p></li>
<li><p>Colega: ‚Äúmas porque ele n√£o estava achando o notebook?‚Äù</p></li>
<li><p>Eu: ‚Äúbom, o pipeline est√° procurando um notebook chamado ‚ÄòX‚Äô, mas esse notebook sumiu. N√£o existe em nosso ambiente‚Äù.</p></li>
<li><p>Colega: ‚Äúespere! Eu me lembro deste caderno! Acho que acabei de renome√°-lo h√° alguns dias‚Äù</p></li>
<li><p>Eu: ‚Äúespere! Voc√™ renomeou um notebook em produ√ß√£o?‚Äù</p></li>
<li><p>Colega: ‚Äúsim, acho que sim‚Äù</p></li>
</ul>
<p>Com este di√°logo, provavelmente poder√≠amos ter resolvido o quebra-cabe√ßa muito mais rapidamente e corrigido os erros antes que mais danos pudessem ser criados. Portanto, se eu tivesse comunicado a esse colega que exclu√≠ o pipeline, provavelmente atingir√≠amos o cerne do problema mais rapidamente.</p>
<p>Tudo come√ßou quando esse nosso colega decidiu renomear um notebook diretamente no ambiente de produ√ß√£o sem que soub√©ssemos. Isso com certeza foi um erro, mas quem n√£o erra as vezes n√©? Al√©m disso, como descrevemos no artigo, o sistema de ‚ÄúRevisions‚Äù do Databricks √© limitado e n√£o foi capaz de gravar essa mudan√ßa t√£o importante no notebook e, por causa disso, n√≥s inicialmente ficamos no escuro. N√≥s n√£o t√≠nhamos ideia do que havia acontecido com o notebook.</p>
<p>Levamos uma semana para realmente descobrir o que estava causando o ‚Äúdesaparecimento‚Äù dos notebooks. Se us√°ssemos o Git para rastrear todas as altera√ß√µes feitas nos notebooks publicados no ambiente de produ√ß√£o, n√≥s ter√≠amos identificado a ‚Äúa√ß√£o de renomear‚Äù muito, muito, muito mais r√°pido. Portanto, n√£o usar o Git nesses notebooks tamb√©m foi um erro.</p>
</section>
<section id="como-o-git-nos-ajudou-a-resolver-o-problema" class="level1">
<h1>Como o Git nos ajudou a resolver o problema</h1>
<p>O Git √© uma ferramenta extremamente poderosa. Ao termos um servidor centralizado que registra todas as mudan√ßas que cada pessoa faz no projeto, conseguimos olhar para o passado, e entender quais mudan√ßas foram feitas. Voc√™ pode realmente ver a evolu√ß√£o ou a linha do tempo do seu projeto e perceber quantos recursos ou melhorias voc√™ fez no projeto. Voc√™ tamb√©m pode identificar as decis√µes que tomou no passado. Isso lhe d√° a capacidade de repensar o seu processo de tomada de decis√£o.</p>
<p>Um fato que sab√≠amos desde o in√≠cio: um pipeline de dados e um notebook de Python simplesmente desapareceram de nosso ambiente. Com o Git conseguimos rastrear e entender como, quando e por que o pipeline de dados desapareceu, e conseguimos localizar o pipeline de dados novamente, restaur√°-lo ao seu estado anterior e reenviar os arquivos que o nosso cliente precisava. Se us√°ssemos o Git nos notebooks, tamb√©m poder√≠amos rastrear as opera√ß√µes de ‚Äúrenomear‚Äù que haviam sido feitas nesses notebooks.</p>
<p>N√≥s n√£o apenas corrigimos o problema, mas tamb√©m, ao entender o que aconteceu e quais decis√µes foram tomadas que levaram ao desaparecimento do pipeline de dados, pudemos identificar as falhas em nosso processo de tomada de decis√£o. E ao identificar esses problemas, agora podemos resolv√™-los, para n√£o cometermos esses erros novamente.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>O que √© um pipeline? Um pipeline √© apenas uma sequ√™ncia de etapas (ou tarefas) a serem realizada em uma hora espec√≠fica do dia (ou em um dia espec√≠fico da semana ou do m√™s, etc.). E um pipeline de dados √© um pipeline que cont√©m tarefas que carregam, transformam, enviam ou ingerem dados de alguma forma.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Em resumo, um Pull Request (ou PR) √© uma <strong>proposta</strong> para realizar uma opera√ß√£o <code>git merge</code>. Em outras palavras, voc√™ cria um PR quando deseja mesclar as altera√ß√µes feitas em uma branch em outra branch (na maioria das vezes a main branch). O aspecto de ‚Äúproposta‚Äù de uma PR significa que este PR precisa ser aprovado para ser efetivamente executado. Um PR n√£o √© um recurso do Git. Na verdade, √© um recurso padr√£o da maioria dos provedores de servi√ßos Git. Ent√£o voc√™ cria um PR dentro de uma plataforma de servi√ßos Git como GitHub, GitLab e Azure DevOps, e n√£o dentro do pr√≥prio Git. Se voc√™ n√£o est√° familiarizado com PRs, a <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">documenta√ß√£o do GitHub tem um excelente artigo sobre isso</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>