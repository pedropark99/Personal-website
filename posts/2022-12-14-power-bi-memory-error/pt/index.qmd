---
title: "Erro de mem√≥ria no Power BI Online? Hora de repensar o seu dashboard"
description: "Um erro de mem√≥ria no Power BI Online √© um forte sinal de que voc√™ precisa repensar o design de seu dashboard. Neste post explico que estrat√©gias voc√™ pode adotar para enfrentar esse problema, e quais perguntas s√£o interessantes de serem respondidas"
date: 2022-12-14
categories: ["Power BI", "Power BI Online"]
image: './../featured.png'
---


# Introdu√ß√£o

Em um dia recente, eu descobri que um dos dashboards que estavam publicados em nosso ambiente de produ√ß√£o do Power BI Online havia sofrido um erro de atualiza√ß√£o. Logo, eu prontamente parei o que estava fazendo e comecei a investigar o motivo do erro, at√© porque: 1) o nosso cliente depende dos dados desse dashboard ; e 2) erros em produ√ß√£o n√£o s√£o legais!

Nesse post, eu quero mostrar como esse tipo de erro de atualiza√ß√£o pode ser um forte sinal de que voc√™ precisa repensar o design de seu dashboard. Em outras palavras, vou descrever como voc√™ pode evitar esse tipo erro, ao pensar muito bem em como o design de seu dashboard atende as necessidades de seu cliente.

# Contexto

Bem, voc√™ j√° sabe que tudo come√ßou por um erro durante a atualiza√ß√£o de um dashboard publicado no Power BI Online. Por√©m, este n√£o era qualquer erro, e sim, um erro de falta de mem√≥ria:

```{r, echo = FALSE, fig.cap = "Mensagem de erro da atualiza√ß√£o no Power BI Online", out.width = "80%"}
knitr::include_graphics("../image.png")
```

Perceba pela mensagem acima, que o motivo do erro foi uma falta de mem√≥ria (*insufficient memory*) nos clusters respons√°veis por executar a atualiza√ß√£o. O que isso significa? Significa que este dashboard estava pedindo por um volume t√£o grande, mas t√£o grande de dados durante a atualiza√ß√£o, que os clusters que estavam executando essa atualiza√ß√£o n√£o tinham mais espa√ßo para alocar esse volume t√£o grande de dados. Por isso, o Power BI decidiu simplesmente parar a atualiza√ß√£o antes que algum computador explodisse `r emoji::emoji("grinning_face_with_sweat")`;




Era um erro de "Falta de mem√≥ria". Quando fui investigar, percebi que esse dash estava puxando todos os inputs inesperados do fluxo, em um per√≠odo de mais de 1 ano. Ou seja, o dash estava basicamente puxando mais de 60 milh√µes de linhas em inputs inesperados, e era esse tanto de linhas que estava causando o erro

Inicialmente n√≥s corrigimos esse erro ao ligar a atualiza√ß√£o incremental nessa tabela. Desse modo, a cada atualiza√ß√£o di√°ria puxamos apenas os dados mais recentes, e n√£o a tabela inteira

At√© a√≠ tudo bem. Deu pra resolver o problema de um modo simples na hora. Mas eu acho que a melhor solu√ß√£o mesmo era repensar o porque diabos a gente precisa de >60 milh√µes de dados

Se vcs passarem por um caso parecido com esse, ao inv√©s de tentaram formas alternativas de fazer a atualiza√ß√£o funcionar (como eu fiz), tentem o porqu√™ desses dados. Pq na maioria desses casos, vc est√° falhando no design do dash, e desperdi√ßando recursos

Tipo, no meu caso, porque diabos eu estou puxando 60 milh√µes de inputs inesperados? Eu por acaso espero que o meu cliente leia esses 60 milh√µes de inputs? Ser√° que um wordcloud de tantos inputs vai ser algo √∫til (acho bem improv√°vel)?

*Tentem repensar o porqu√™ dos dados eu quis dizer

Ao inv√©s de trazer todos os dados, pq n√£o trazer apenas uma amostra aleat√≥ria? Para isso, temos o m√©todo sample() em pyspark. Ent√£o pra pegar uma amostra de 100 linhas seria tabela.sample(100)

Outra pergunta que vc pode fazer, ser√° que eu preciso mesmo manter o hist√≥rico disso no dash? Ser√° que meu cliente precisa FREQUENTEMENTE puxar os inputs inesperados de 6 meses atr√°s?


Se ele n√£o precisa puxar ou consultar essas informa√ß√µes com muita frequ√™ncia, √© bem prov√°vel que essa info n√£o deveria estar no dashboard


O que voc√™ trouxe parece que foi uma constru√ß√£o antiga, modelada pra necessidade X, e ela n√£o √© mais a mesma hoje em dia

√â interessante pensar no processo de evolu√ß√£o/revis√£o dos nossos dashs, adequando eles pros usos atuais (coisa que nem sempre a gente consegue üòÖ)
Viajando um pouco aqui, um dash de atendimento humano pra acompanhar a m√©trica X (abandono, sei l√°).. faz sentido acompanhar essa m√©trica pro resto da vida? Ou vai chegar uma hora que o abandono √© normalizado, e vamos ter alguma outra dor pra investigar, analisar, melhorar, medir?
